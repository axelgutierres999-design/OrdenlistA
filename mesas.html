<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mapa de Mesas | OrdenLista</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
    <link rel="stylesheet" href="css/app.css">
    <style>
      .grid-mesas { display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 25px; margin-top: 2rem; }
      
      .tarjeta-mesa { 
        background: white; border-radius: 16px; padding: 20px; text-align: center; 
        box-shadow: 0 4px 12px rgba(0,0,0,0.08); border-top: 6px solid #2ecc71; 
        transition: all 0.3s ease; position: relative; 
      }
      
      .tarjeta-mesa.ocupada { border-top-color: #f1c40f; background: #fffcf0; }
      .tarjeta-mesa.listo { border-top-color: #e74c3c; background: #fff5f5; animation: pulse-red 2s infinite; }
      
      @keyframes pulse-red { 
        0% { box-shadow: 0 0 0 0px rgba(231, 76, 60, 0.2); } 
        70% { box-shadow: 0 0 0 10px rgba(231, 76, 60, 0); } 
        100% { box-shadow: 0 0 0 0px rgba(231, 76, 60, 0); } 
      }

      .badge-mesa { font-size: 0.75rem; padding: 2px 8px; border-radius: 10px; font-weight: bold; }
      .badge-libre { background: #e8f5e9; color: #2e7d32; }
      .badge-ocupada { background: #fffde7; color: #f9a825; }
      .badge-listo { background: #ffebee; color: #c62828; }

      /* Modal Ticket Estilo Papel */
      #modalTicket article { background: #f9f9f9; max-width: 350px; padding: 0; }
      .ticket-body { padding: 20px; font-family: 'Courier New', Courier, monospace; color: #000; }
      
      @media print {
        body * { visibility: hidden; }
        #modalTicket, #modalTicket article, .ticket-body, .ticket-body * { visibility: visible; }
        #modalTicket article { position: absolute; left: 0; top: 0; width: 100%; box-shadow: none; }
        .no-print { display: none !important; }
      }
    </style>
</head>
<body>
<nav class="container-fluid nav-inicio nav-cuadros">
  <ul class="logo-section" style="display:flex; align-items:center; gap:0.6rem;">
    <li><strong>‚òï OrdenLista</strong></li>
    <li>
      <a href="ajustes.html" role="button" class="contrast" 
         style="border:1px solid white; border-radius:8px; padding:4px 10px;">
        ‚öôÔ∏è Ajustes
      </a>
    </li>
  </ul>
  <ul id="menuNavegacion" class="nav-botones"></ul>
</nav>

    <main class="container">
      <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
        <h1>üó∫Ô∏è Mapa de Mesas</h1>
        <div style="display: flex; gap: 10px; align-items: center; background: #f4f4f4; padding: 10px; border-radius: 8px;">
          <small>Total de Mesas:</small>
          <input type="number" id="inputNumMesas" value="10" style="width: 70px; margin: 0; height: 35px;">
          <button onclick="guardarConfiguracionMesas()" class="outline" style="margin: 0; padding: 5px 15px; height: 35px;">üíæ Guardar</button>
        </div>
      </div>

      <div class="grid-mesas" id="gridMesas">
          <article aria-busy="true" style="text-align: center;">Cargando mesas...</article>
      </div>
    </main>

    <dialog id="modalCobro">
      <article style="max-width: 400px;">
        <header>
          <button aria-label="Close" rel="prev" onclick="document.getElementById('modalCobro').close()"></button>
          <h3>üí∏ Finalizar Cuenta</h3>
        </header>
        <div style="text-align:center; margin-bottom:20px;">
            <h2 id="cobroMesaTitulo">Mesa X</h2>
            <div style="font-size:3rem; font-weight:bold; color:#2ecc71;">$<span id="cobroTotal">0.00</span></div>
            <p><small>Selecciona el m√©todo de pago:</small></p>
        </div>
        <div class="grid">
            <button onclick="procesarPago('efectivo')" style="background:#27ae60; border:none;">üíµ Efectivo</button>
            <button onclick="procesarPago('tarjeta')" style="background:#2980b9; border:none;">üí≥ Tarjeta</button>
        </div>
      </article>
    </dialog>

    <dialog id="modalTicket">
      <article>
        <div class="ticket-body">
          <div style="text-align:center; border-bottom: 2px dashed #000; padding-bottom:10px; margin-bottom:15px;">
            <h2 style="margin:0; font-size:1.2rem;">‚òï ORDEN LISTA</h2>
            <p style="font-size:0.7rem; margin:0;">TICKET DE CONSUMO</p>
          </div>
          
          <div style="font-size:0.8rem; margin-bottom:10px;">
            <p style="margin:0;"><strong>MESA:</strong> <span id="t-mesa">--</span></p>
            <p style="margin:0;"><strong>FECHA:</strong> <span id="t-fecha">--</span></p>
            <p style="margin:0;"><strong>FOLIO:</strong> #<span id="t-folio">--</span></p>
          </div>

          <table style="width:100%; font-size:0.8rem; margin-bottom:10px;">
            <tbody id="t-items">
              </tbody>
          </table>

          <div style="border-top: 2px dashed #000; padding-top:10px; text-align:right;">
            <h3 style="margin:0;">TOTAL: $<span id="t-total">0.00</span></h3>
          </div>
        </div>
        
        <footer class="no-print" style="padding: 10px; display: flex; gap: 10px;">
          <button class="secondary outline" onclick="document.getElementById('modalTicket').close()" style="flex:1;">Cerrar</button>
          <button onclick="window.print()" style="flex:1;">üñ®Ô∏è Imprimir</button>
        </footer>
      </article>
    </dialog>

    <!-- ‚úÖ LIBRER√çAS Y JS PRINCIPALES -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script> <!-- üÜï Librer√≠a para QR -->
    <script src="js/supabase-client.js"></script>
    <script src="js/logout.js"></script>
    <script src="js/app.js"></script>
    <script src="js/mesas.js"></script>
</body>
</html>
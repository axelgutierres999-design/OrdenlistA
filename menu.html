<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>OrdenLista | MenÃº y Pedidos</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
  <link rel="stylesheet" href="css/app.css" />
  <style>
    /* Estilos base */
    .tarjeta-producto {
      padding: 0; /* Quitamos padding para que la imagen toque bordes */
      border: 1px solid #eee;
      border-radius: 12px;
      cursor: pointer;
      transition: all 0.2s ease;
      background: white;
      display: flex;
      flex-direction: column;
      position: relative;
      overflow: hidden; /* Importante para bordes redondeados */
    }
    .tarjeta-producto:hover {
      box-shadow: 0 8px 16px rgba(0,0,0,0.1);
      transform: translateY(-4px);
      border-color: #10ad93;
    }
    .tarjeta-producto .info {
        padding: 1rem;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        flex-grow: 1;
    }
    .edit-btn {
      /* Estilos manejados en JS, pero esto es base */
      z-index: 20;
    }
    .panel-orden {
      background-color: #fff;
      padding: 1.5rem;
      border-radius: 16px;
      border: 1px solid #eef0f2;
      box-shadow: 0 4px 20px rgba(0,0,0,0.05);
      position: sticky;
      top: 2rem;
      transition: all 0.3s ease;
    }
    .panel-orden.llevar-activo {
      background: #f4fffc;
      border-color: #10ad93;
      box-shadow: 0 0 15px rgba(16,173,147,0.3);
    }
    .btn-llevar {
      background: #f4f4f4;
      border: 1px solid #ccc;
      padding: 6px 10px;
      border-radius: 6px;
      cursor: pointer;
      color: #333;
      font-weight: 500;
    }
    .btn-llevar.activo {
      background: #10ad93;
      color: white;
      border-color: #10ad93;
    }
    .alerta-llevar {
      background: #e0fdf5;
      border: 1px solid #10ad93;
      color: #0a6b5f;
      padding: 8px;
      text-align: center;
      border-radius: 8px;
      margin-bottom: 10px;
      display: none;
    }
    .alerta-llevar.mostrar { display: block; }
    
    /* BotÃ³n flotante para mÃ³vil */
    .fab-add {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: #10ad93;
      color: white;
      font-size: 2rem;
      border: none;
      border-radius: 50%;
      width: 60px;
      height: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 6px 12px rgba(0,0,0,0.2);
      cursor: pointer;
      z-index: 999;
    }
  </style>
</head>
<body>
 <nav class="container-fluid nav-inicio" style="background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
  <ul style="display:flex; align-items:center; gap:0.6rem;">
    <li><strong style="font-size: 1.3rem; color: #10ad93;">â˜• OrdenLista</strong></li>
    <li style="color: #888;">| Pedidos</li>
    <li>
      <a href="ajustes.html" role="button" class="contrast"
         style="border:1px solid #10ad93; border-radius:8px; padding:4px 10px; color:#10ad93; text-decoration:none;">
        âš™ï¸ Ajustes
      </a>
    </li>
  </ul>
  <ul id="menuNavegacion" class="nav-botones"></ul>
</nav>

  <main class="container">
    <header>
      <h1>ğŸ“œ MenÃº y Pedidos</h1>
      <p>Selecciona los productos para generar una nueva orden.</p>
    </header>

    <div class="buscador-container" style="display:flex; gap:10px; margin-bottom:20px;">
      <input type="search" id="buscarProducto" placeholder="ğŸ” Buscar platillo..." style="flex:1;">
      <select id="filtroCategoria" style="width:auto;">
        <option value="Todos">Todas</option>
        <option value="Platillo">Platillos</option>
        <option value="Bebidas">Bebidas</option>
        <option value="Postres">Postres</option>
      </select>
    </div>

    <div class="grid">
      <section>
        <div id="contenedorProductos" class="grid" style="grid-template-columns:repeat(auto-fill,minmax(160px,1fr)); gap:1rem;">
          <article aria-busy="true">Cargando...</article>
        </div>
      </section>

      <section class="panel-orden" id="panelOrden">
        <div class="orden-header" style="display:flex; justify-content:space-between; align-items:center; margin-bottom:0.5rem;">
          <h3 style="margin:0;">ğŸ›’ Orden</h3>
          <button id="btnParaLlevar" class="btn-llevar">ğŸ¥¡ Para Llevar</button>
        </div>

        <div id="alertaLlevar" class="alerta-llevar">ğŸ“¦ Modo "Para Llevar" activado</div>

        <div id="listaItemsOrden" style="min-height:100px; margin-bottom:1rem; max-height:300px; overflow-y:auto;">
          <small style="display:block; text-align:center; color:#999;">Carrito vacÃ­o</small>
        </div>

        <label for="comentarioPedido">ğŸ“ Nota General:</label>
        <textarea id="comentarioPedido" placeholder="Ej: Sin cubiertos..." rows="1" style="resize:none;"></textarea>

        <hr>
        <div style="display:flex; justify-content:space-between; font-weight:bold; font-size:1.5rem; color:#10ad93; margin-bottom:1rem;">
          <span>Total:</span><span id="ordenTotal">$0.00</span>
        </div>

        <label for="selectMesa">ğŸª‘ Mesa:</label>
        <select id="selectMesa" required>
          <option value="" disabled selected>Selecciona mesa...</option>
        </select>

        <button id="btnProcesarOrden" style="width:100%; background:#10ad93; border:none;" disabled>
          ğŸš€ Procesar Pedido
        </button>
      </section>
    </div>
  </main>

  <button id="btnAgregarProducto" class="fab-add" title="Agregar producto" style="display:none;" onclick="window.abrirEditor()">ï¼‹</button>

  <dialog id="modalEditarMenu" style="border:none; border-radius:15px; padding:0; width:90%; max-width:450px;">
    <div style="padding:20px;">
        <h3 style="margin-top:0;">âœï¸ Editar / Crear</h3>
        
        <form id="formProducto" style="display:flex; flex-direction:column; gap:12px;">
        <input type="hidden" id="editId">
        
        <div style="text-align:center; position:relative;">
            <img id="imgPreview" src="https://via.placeholder.com/150" 
                style="width:120px; height:120px; object-fit:cover; border-radius:10px; border:2px dashed #ccc; cursor:pointer;"
                title="Toca para subir imagen">
            <p style="font-size:12px; color:#666; margin:5px 0;">ğŸ“¸ Toca la imagen para subir foto</p>
        </div>
        <input type="hidden" id="editImg"> 
        
        <label>
            Nombre:
            <input type="text" id="editNombre" required>
        </label>
        
        <div style="display:flex; gap:10px;">
            <label style="flex:1">
            Precio:
            <input type="number" id="editPrecio" step="0.01" required>
            </label>
            <label style="flex:1">
            CategorÃ­a:
            <select id="editCategoria">
                <option value="Platillo">Platillo</option>
                <option value="Bebidas">Bebidas</option>
                <option value="Postres">Postres</option>
                <option value="Otros">Otros</option>
            </select>
            </label>
        </div>

        <div style="display:flex; gap:10px; margin-top:10px;">
            <button type="button" onclick="document.getElementById('modalEditarMenu').close()" style="flex:1; background:#ccc; border:none; color:black;">Cancelar</button>
            <button type="submit" style="flex:1; background:#10ad93; border:none;">Guardar</button>
        </div>
        
        <button type="button" id="btnEliminarProd" style="background:none; color:#e74c3c; border:1px solid #e74c3c; padding:8px; width:100%; margin-top:5px; display:none;">
            ğŸ—‘ï¸ Eliminar Platillo
        </button>
        </form>
    </div>
  </dialog>
  <!-- ================= MODAL COBRO PEDIDO ================= -->
<dialog id="modalCobroPedido">
  <article style="max-width: 420px;">
    <header>
      <button aria-label="Close" rel="prev"
        onclick="document.getElementById('modalCobroPedido').close()"></button>
      <h3>ğŸ’¸ Cobrar Pedido</h3>
    </header>

    <div style="text-align:center; margin-bottom:20px;">
      <h2>Pedido Para Llevar</h2>
      <div style="font-size:3rem; font-weight:bold; color:#10ad93;">
        $<span id="totalCobroPedido">0.00</span>
      </div>
      <p><small>Selecciona mÃ©todo de pago</small></p>
    </div>

    <div class="grid">
      <button onclick="pagarPedido('efectivo')" style="background:#27ae60;border:none;">
        ğŸ’µ Efectivo
      </button>

      <button onclick="mostrarOpcionesTarjeta()" style="background:#2980b9;border:none;">
        ğŸ’³ Tarjeta
      </button>
    </div>
  </article>
</dialog>

<!-- ================= MODAL OPCIONES TARJETA ================= -->
<dialog id="modalTarjetaPedido">
  <article style="max-width: 420px;">
    <header>
      <button aria-label="Close" rel="prev"
        onclick="document.getElementById('modalTarjetaPedido').close()"></button>
      <h3>ğŸ’³ Pago con Tarjeta</h3>
    </header>

    <p style="text-align:center;"><small>Selecciona tipo de pago</small></p>

    <div class="grid">
      <button onclick="pagarPedido('qr')" style="background:#16a085;border:none;">
        ğŸ“± CÃ³digo QR (CoDi / App)
      </button>

      <button onclick="pagarPedido('transferencia')" style="background:#3498db;border:none;">
        ğŸ¦ Transferencia
      </button>

      <button onclick="pagarPedido('terminal')" style="background:#2c3e50;border:none;">
        ğŸ’³ Terminal Bancaria
      </button>
    </div>

    <footer>
      <button class="secondary outline"
        onclick="document.getElementById('modalTarjetaPedido').close()">
        Cancelar
      </button>
    </footer>
  </article>
</dialog>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="js/supabase-client.js"></script>
  <script src="js/app.js"></script>
  <script src="js/menu.js"></script> 
</body>
</html>